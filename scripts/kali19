set -x
export GIT_SSL_NO_VERIFY=true
export DEBIAN_FRONTEND=noninteractive

wget -q -O - http://archive.kali.org/archive-key.asc | apt-key add
rm -f /etc/apt/sources.list.d/metasploit-framework.list
apt-get update
apt-get install -y apt-utils git make libdpkg-perl xdg-utils perl gdebi-core debhelper

# Install Go and Bettercap
mkdir -p $HOME/go/bin $HOME/go/src $HOME/go/lib
echo 'export GOPATH=$HOME/go' >> $HOME/.bashrc
echo 'export PATH=$PATH:$GOPATH/bin' >> $HOME/.bashrc
export GOPATH=/root/go
export PATH=$PATH:/root/go/bin
# source $HOME/.bashrc
apt-get install -y golang
apt-get install -y libpcap-dev libusb-1.0-0 libusb-1.0-0-dev libnetfilter-queue-dev
apt-get install -y iptables
go get -insecure github.com/bettercap/bettercap
# pushd $GOPATH/src/github.com/bettercap/bettercap && make build && make install && popd
CURRDIR=$(pwd)
cd /root/go/src/github.com/bettercap/bettercap
make build
make install
cd $CURRDIR

# PEAT
# git clone http://gitlab+deploy-token-71:Cs6vABo-9PX16UbssUYg@gitlab.sandia.gov/VEDAR/PEAT.git
# bash ./PEAT/scripts/install-all.sh
git clone http://gitlab+deploy-token-72:xyTCES_ggdBiLgxWhRV3@gitlab.sandia.gov/cegoes/peat-releases.git
mv ./peat-releases/PEAT /usr/local/bin/peat
chmod +x /usr/local/bin/peat
rm -rf ./peat-releases

# these are manually downloaded because SNL blocks some packages from http.kali.org :(
# also davtest and msfpc must be built from source...SNL flags them as viruses :(
git clone git://git.kali.org/packages/davtest.git
git clone -b kali/master git://git.kali.org/packages/msfpc.git
# Metasploit 5
curl https://raw.githubusercontent.com/rapid7/metasploit-omnibus/master/config/templates/metasploit-framework-wrappers/msfupdate.erb > msfinstall && chmod 755 msfinstall && ./msfinstall
cd davtest && dpkg-buildpackage -b -rfakeroot -us -uc && cd ../
cd msfpc && dpkg-buildpackage -b -rfakeroot -us -uc && cd ../
curl -O http://old.kali.org/kali/pool/main/k/kali-menu/kali-menu_2018.4.0_all.deb
curl -O http://old.kali.org/kali/pool/main/i/inetsim/inetsim_1.2.7+dfsg.1-1kali1_all.deb
curl -O http://old.kali.org/kali/pool/main/m/mimikatz/mimikatz_2.1.1-20181209-0kali1_all.deb
curl -O http://old.kali.org/kali/pool/main/n/nishang/nishang_0.7.6-0kali1_all.deb
curl -O http://old.kali.org/kali/pool/main/r/responder/responder_2.3.3.9-0kali2_all.deb
curl -O http://old.kali.org/kali/pool/main/s/set/set_7.7.9-0kali1_all.deb
curl -O http://mirrors.ocf.berkeley.edu/kali/pool/main/s/sqlmap/sqlmap_1.3.3-1_all.deb
for i in `ls *.deb`; do gdebi -n $i; done
rm -rf *.deb davtest* msfpc*

# apt-get install -y xinit
# apt-get install -y kali-desktop-xfce
# apt-get install -y kali-defaults kali-root-login desktop-base xfce4 xfce4-places-plugin xfce4-goodies
# apt-get install -y firefox-esr 
apt-get install -y kali-linux-top10
# apt-get install -y kali-linux-all

# Install some useful tools/utilities as well as SNMP MIBs
apt-get install -y jq dos2unix zip unzip tree nano arping iftop snmp-mibs-downloader python3-venv

# Useful for building stuff
apt-get install -y patchelf cython cython3 python3-dev upx-ucl libpcap-dev libssl-dev zlib1g-dev libxml2-dev libxslt1-dev libxmlsec1-dev libffi-dev

echo "root:toor" | chpasswd
